{% extends "base.html" %}
{% block content %}
<section class="container admin-section">
    <header class="section-header">
        <h1>{{ t('usersSection') }}</h1>
        <a class="btn small" href="{{ url_for('admin_dashboard') }}">{{ t('backDashboard') }}</a>
    </header>
    <div class="card">
        <h2>{{ t('createUserTitle') }}</h2>
        <form method="post" class="form-grid">
            <input type="hidden" name="action" value="create">
            <div class="form-group">
                <label for="newUsername">{{ t('usernameLabel') }}</label>
                <input id="newUsername" name="username" required>
            </div>
            <div class="form-group">
                <label for="newPassword">{{ t('passwordLabel') }}</label>
                <input id="newPassword" name="password" type="password" required>
            </div>
            <div class="form-group">
                <label for="newRole">{{ t('roleLabel') }}</label>
                <select id="newRole" name="role">
                    <option value="Administrator">{{ t('roleAdmin') }}</option>
                    <option value="Бармен">{{ t('roleBartender') }}</option>
                    <option value="Кассир">{{ t('roleCashier') }}</option>
                </select>
            </div>
            <button class="btn" type="submit">{{ t('createButton') }}</button>
        </form>
    </div>
    <div class="card">
        <h2>{{ t('existingUsers') }}</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>{{ t('usernameLabel') }}</th>
                    <th>{{ t('roleLabel') }}</th>
                    <th>{{ t('actionsLabel') }}</th>
                </tr>
            </thead>
            <tbody>
            {% for entry in users %}
                <tr>
                    <td>{{ entry.get('username') }}</td>
                    <td>{{ entry.get('role') }}</td>
                    <td>
                        {% if entry.get('username') != 'root' %}
                        <form method="post" class="inline-form">
                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="userId" value="{{ entry.get('id') }}">
                            <select name="role">
                                <option value="Administrator" {% if entry.get('role') == 'Administrator' %}selected{% endif %}>{{ t('roleAdmin') }}</option>
                                <option value="Бармен" {% if entry.get('role') == 'Бармен' %}selected{% endif %}>{{ t('roleBartender') }}</option>
                                <option value="Кассир" {% if entry.get('role') == 'Кассир' %}selected{% endif %}>{{ t('roleCashier') }}</option>
                            </select>
                            <button class="btn small" type="submit">{{ t('updateButton') }}</button>
                        </form>
                        <form method="post" class="inline-form" onsubmit="return confirm('{{ t('confirmDelete') }}')">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="userId" value="{{ entry.get('id') }}">
                            <button class="btn small danger" type="submit">{{ t('deleteButton') }}</button>
                        </form>
                        {% else %}
                        <span>{{ t('rootProtected') }}</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
